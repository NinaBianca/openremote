execution:
- concurrency: 1
  scenario: mqtt-client-auto-provision-sub
- concurrency: 1
  delay: 10s
  scenario: mqtt-client-auto-provision-pub

scenarios:

  mqtt-client-auto-provision-sub:
    protocol: mqtt
    requests:
    - cmd: connect
      addr: localhost
    - cmd: subscribe
      topic: provisioning/${id}/response
      time: 15s
      min-count: 1
    - cmd: disconnect

    data-sources:
    - path: devices.csv
      delimiter: ','
      quoted: false
      encoding: "utf-8"
      loop: false
      variable-names: id,cert
      random-order: false
      
  mqtt-client-auto-provision-pub:
    protocol: mqtt
    requests:
    - cmd: connect
      addr: localhost
    - cmd: publish
      topic: provisioning/${id}/request
      message: "{\"type\":\"x509\",\"cert\":\"${cert}\"}"
    - cmd: disconnect

    data-sources:
    - path: devices.csv
      delimiter: ','
      quoted: false
      encoding: "utf-8"
      loop: false
      variable-names: id,cert
      random-order: false
